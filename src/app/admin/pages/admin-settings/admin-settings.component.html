<div class="max-w-5xl mx-auto space-y-6">
  <div
    *ngIf="saveMessage"
    class="rounded-lg border border-green-200 bg-green-50 px-4 py-3 text-sm font-medium text-green-800"
  >
    {{ saveMessage }}
  </div>
  <nav class="flex text-sm font-medium text-text-secondary">
    <a class="hover:text-primary transition-colors" routerLink="/admin/dashboard">Dashboard</a>
    <span class="mx-2">/</span>
    <span class="text-primary font-semibold">Settings</span>
  </nav>
  <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-text-main tracking-tight">Settings</h1>
      <p class="text-text-secondary mt-1">
        Manage store configuration, payment gateways, and team permissions.
      </p>
    </div>
    <div class="flex gap-3">
      <button
        class="px-4 py-2 bg-white border border-border rounded-lg text-sm font-medium text-text-main shadow-sm hover:bg-background-light transition-colors"
        type="button"
        (click)="resetForm()"
      >
        Cancel
      </button>
      <button
        class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium shadow-md hover:bg-[#083a4a] transition-colors flex items-center gap-2"
        type="button"
        (click)="saveChanges()"
      >
        <span class="material-symbols-outlined text-[18px]">save</span>
        Save Changes
      </button>
    </div>
  </div>
  <div class="border-b border-border">
    <nav aria-label="Tabs" class="-mb-px flex space-x-8 overflow-x-auto">
      <button
        *ngFor="let tab of tabs"
        class="whitespace-nowrap py-4 px-1 border-b-2 text-sm"
        type="button"
        [ngClass]="
          activeTab === tab
            ? 'border-primary text-primary border-b-2 font-semibold'
            : 'border-transparent text-text-secondary hover:text-primary hover:border-gray-300 font-medium'
        "
        (click)="setActiveTab(tab)"
      >
        {{ tab }}
      </button>
    </nav>
  </div>
  <div class="space-y-8">
    <form [formGroup]="settingsForm" class="space-y-8">
      <section
        *ngIf="activeTab === 'General'"
        class="bg-surface rounded-xl border border-border shadow-sm overflow-hidden"
      >
        <div class="p-6 border-b border-border">
          <h3 class="text-lg font-bold text-text-main">Brand Information</h3>
          <p class="text-sm text-text-secondary">
            Configure how your brand appears to customers.
          </p>
        </div>
        <div class="p-6 space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="col-span-1">
              <label class="block text-sm font-medium text-text-main mb-2">Store Logo</label>
              <p class="text-xs text-text-secondary mb-3">Used on invoices and email headers.</p>
            </div>
            <div class="col-span-2">
              <div class="flex items-center gap-6">
                <div
                  class="size-20 rounded-lg bg-background-light border border-border flex items-center justify-center overflow-hidden relative group"
                  role="button"
                  tabindex="0"
                  (click)="triggerLogoUpload()"
                >
                  <ng-container *ngIf="logoPreviewUrl; else logoPlaceholder">
                    <img
                      [src]="logoPreviewUrl"
                      class="w-full h-full object-contain"
                      alt="Brand Logo"
                    />
                  </ng-container>
                  <ng-template #logoPlaceholder>
                  <span class="material-symbols-outlined text-4xl text-text-secondary group-hover:hidden">
                    image
                  </span>
                  </ng-template>
                  <div
                    class="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center cursor-pointer"
                  >
                    <span class="material-symbols-outlined text-white">edit</span>
                  </div>
                </div>
                <div class="flex-1">
                  <div
                    class="flex justify-center px-6 pt-5 pb-6 border-2 border-border border-dashed rounded-lg hover:bg-background-light transition-colors cursor-pointer"
                    (click)="triggerLogoUpload()"
                  >
                    <div class="space-y-1 text-center">
                      <span class="material-symbols-outlined text-text-secondary text-3xl mx-auto mb-2">
                        cloud_upload
                      </span>
                      <div class="flex text-sm text-text-secondary">
                        <label
                          class="relative cursor-pointer rounded-md font-medium text-primary focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary"
                          for="file-upload"
                        >
                          <span>Upload a file</span>
                          <input
                            #fileUpload
                            class="sr-only"
                            id="file-upload"
                            name="file-upload"
                            type="file"
                            accept="image/png,image/jpeg,image/gif"
                            (change)="onLogoSelected($event)"
                          />
                        </label>
                        <p class="pl-1">or drag and drop</p>
                      </div>
                      <p class="text-xs text-text-secondary">PNG, JPG, GIF up to 2MB</p>
                    </div>
                  </div>
                  <p *ngIf="logoError" class="mt-2 text-xs text-red-600">{{ logoError }}</p>
                </div>
              </div>
            </div>
          </div>
          <hr class="border-border" />
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="col-span-2 md:col-span-1">
              <label class="block text-sm font-medium text-text-main mb-1" for="store-name"
                >Store Name</label
              >
              <input
                class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
                id="store-name"
                name="store-name"
                type="text"
                formControlName="storeName"
              />
            </div>
            <div class="col-span-2 md:col-span-1">
              <label class="block text-sm font-medium text-text-main mb-1" for="support-email"
                >Support Email</label
              >
              <input
                class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
                id="support-email"
                name="support-email"
                type="email"
                formControlName="supportEmail"
              />
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-medium text-text-main mb-1" for="description"
                >Store Description</label
              >
              <textarea
                class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm resize-none"
                id="description"
                name="description"
                rows="3"
                formControlName="description"
              ></textarea>
              <p class="mt-2 text-xs text-text-secondary">
                Brief description for SEO and footer content.
              </p>
            </div>
          </div>
        </div>
      </section>
      <section
        *ngIf="activeTab === 'Payments'"
        class="bg-surface rounded-xl border border-border shadow-sm overflow-hidden"
      >
        <div class="p-6 border-b border-border flex justify-between items-center">
          <div>
            <h3 class="text-lg font-bold text-text-main">Payment Gateways</h3>
            <p class="text-sm text-text-secondary">Manage how you accept payments.</p>
          </div>
          <span
            class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded border border-green-200"
            >Production Mode Active</span
          >
        </div>
        <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6" formGroupName="payments">
          <div
            class="border border-border rounded-xl p-5 flex flex-col justify-between relative overflow-hidden group hover:border-primary transition-colors bg-white"
          >
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center gap-3">
                <div
                  class="size-10 bg-[#635BFF] text-white rounded-lg flex items-center justify-center font-bold text-xl"
                >
                  S
                </div>
                <div>
                  <h4 class="font-bold text-text-main">Stripe</h4>
                  <p class="text-xs text-text-secondary">Credit Card, Apple Pay</p>
                </div>
              </div>
              <div
                class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"
              >
                <input
                  class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer checked:right-0 checked:border-primary transition-all duration-300"
                  id="stripe-toggle"
                  name="toggle"
                  type="checkbox"
                  formControlName="stripeEnabled"
                />
                <label
                  class="toggle-label block overflow-hidden h-5 rounded-full bg-accent cursor-pointer"
                  for="stripe-toggle"
                  [ngClass]="stripeEnabled ? '' : 'bg-gray-300'"
                ></label>
              </div>
            </div>
            <div class="space-y-3 mb-4">
              <div>
                <label class="text-[10px] uppercase font-bold text-text-secondary tracking-wider"
                  >Publishable Key</label
                >
                <div class="flex items-center bg-background-light rounded border border-border px-2 py-1.5 mt-1">
                  <code class="text-xs text-text-main truncate flex-1">{{ stripePublishableKey }}</code>
                  <button
                    class="text-text-secondary hover:text-primary"
                    type="button"
                    (click)="copyStripeKey()"
                  >
                    <span class="material-symbols-outlined text-[16px]">content_copy</span>
                  </button>
                </div>
                <p *ngIf="copiedKey" class="mt-1 text-xs text-green-600">Copied</p>
              </div>
            </div>
            <div class="flex justify-between items-center mt-2 pt-4 border-t border-border">
              <span class="flex items-center gap-1.5 text-xs font-medium text-green-600">
                <span class="size-2 rounded-full bg-green-500"></span> Connected
              </span>
              <button class="text-sm font-medium text-primary hover:underline" type="button">
                Configure
              </button>
            </div>
          </div>
          <div
            class="border border-border rounded-xl p-5 flex flex-col justify-between relative overflow-hidden group hover:border-primary transition-colors bg-white"
          >
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center gap-3">
                <div
                  class="size-10 bg-[#003087] text-white rounded-lg flex items-center justify-center font-bold text-xl italic"
                >
                  P
                </div>
                <div>
                  <h4 class="font-bold text-text-main">PayPal</h4>
                  <p class="text-xs text-text-secondary">Wallet, Pay Later</p>
                </div>
              </div>
              <div
                class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"
              >
                <input
                  class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300"
                  id="paypal-toggle"
                  name="toggle"
                  type="checkbox"
                  formControlName="paypalEnabled"
                />
                <label
                  class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"
                  for="paypal-toggle"
                  [ngClass]="paypalEnabled ? 'bg-accent' : ''"
                ></label>
              </div>
            </div>
            <div class="space-y-3 mb-4 opacity-50 pointer-events-none">
              <div>
                <label class="text-[10px] uppercase font-bold text-text-secondary tracking-wider"
                  >Client ID</label
                >
                <div class="flex items-center bg-background-light rounded border border-border px-2 py-1.5 mt-1">
                  <code class="text-xs text-text-main truncate flex-1">Start setup to generate</code>
                </div>
              </div>
            </div>
            <div class="flex justify-between items-center mt-2 pt-4 border-t border-border">
              <span class="flex items-center gap-1.5 text-xs font-medium text-text-secondary">
                <span class="size-2 rounded-full bg-gray-400"></span> Inactive
              </span>
              <button class="text-sm font-medium text-primary hover:underline" type="button">Setup</button>
            </div>
          </div>
        </div>
      </section>
    </form>
    <section
      *ngIf="activeTab === 'Shipping'"
      class="bg-surface rounded-xl border border-border shadow-sm overflow-hidden mb-8"
    >
      <div class="p-6 border-b border-border flex justify-between items-center">
        <div>
          <h3 class="text-lg font-bold text-text-main">Shipping Zones</h3>
          <p class="text-sm text-text-secondary">Define where you ship and how much it costs.</p>
        </div>
        <button
          class="text-primary text-sm font-bold flex items-center gap-1 hover:underline"
          type="button"
          (click)="startAddZone()"
        >
          <span class="material-symbols-outlined text-[18px]">add</span> Add Zone
        </button>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead class="bg-background-light border-b border-border">
            <tr>
              <th class="px-6 py-3 font-semibold text-text-main" scope="col">Zone Name</th>
              <th class="px-6 py-3 font-semibold text-text-main" scope="col">Region</th>
              <th class="px-6 py-3 font-semibold text-text-main" scope="col">Rates</th>
              <th class="px-6 py-3 font-semibold text-text-main text-right" scope="col">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border">
            <tr
              *ngFor="let zone of shippingZones"
              class="hover:bg-background-light/50 transition-colors"
            >
              <td class="px-6 py-4 font-medium text-text-main">{{ zone.name }}</td>
              <td class="px-6 py-4 text-text-secondary">{{ zone.region }}</td>
              <td class="px-6 py-4">
                <div class="flex gap-2">
                  <span *ngFor="let rate of zone.rates" [ngClass]="rateClass(rate)">
                    {{ rate }}
                  </span>
                </div>
              </td>
              <td class="px-6 py-4 text-right">
                <button
                  class="text-text-secondary hover:text-primary mx-1"
                  type="button"
                  (click)="editZone(zone)"
                >
                  <span class="material-symbols-outlined text-[18px]">edit</span>
                </button>
                <button
                  class="text-text-secondary hover:text-red-600 mx-1"
                  type="button"
                  (click)="deleteZone(zone)"
                >
                  <span class="material-symbols-outlined text-[18px]">delete</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="showZoneForm" class="border-t border-border p-6">
        <form [formGroup]="zoneForm" class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="col-span-1">
            <label class="block text-sm font-medium text-text-main mb-1" for="zone-name">
              Zone Name
            </label>
            <input
              class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
              id="zone-name"
              name="zone-name"
              type="text"
              formControlName="name"
            />
          </div>
          <div class="col-span-1">
            <label class="block text-sm font-medium text-text-main mb-1" for="zone-region">
              Region
            </label>
            <input
              class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
              id="zone-region"
              name="zone-region"
              type="text"
              formControlName="region"
            />
          </div>
          <div class="col-span-1">
            <label class="block text-sm font-medium text-text-main mb-1" for="zone-rates">
              Rates
            </label>
            <input
              class="block w-full rounded-lg border-border bg-background-light text-text-main shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
              id="zone-rates"
              name="zone-rates"
              type="text"
              formControlName="rates"
            />
          </div>
          <div class="col-span-1 md:col-span-3 flex flex-wrap gap-3">
            <button
              class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium shadow-md hover:bg-[#083a4a] transition-colors"
              type="button"
              (click)="saveZone()"
            >
              {{ editingZoneId ? 'Update Zone' : 'Add Zone' }}
            </button>
            <button
              class="px-4 py-2 bg-white border border-border rounded-lg text-sm font-medium text-text-main shadow-sm hover:bg-background-light transition-colors"
              type="button"
              (click)="cancelZoneEdit()"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </section>
    <section
      *ngIf="activeTab === 'User Roles' || activeTab === 'Notifications'"
      class="bg-surface rounded-xl border border-border shadow-sm overflow-hidden"
    >
      <div class="p-6">
        <h3 class="text-lg font-bold text-text-main">{{ activeTab }}</h3>
        <p class="text-sm text-text-secondary mt-1">Coming soon.</p>
      </div>
    </section>
  </div>
  <div class="mt-12 mb-6 text-center text-xs text-text-secondary">
    <p>
      Â© 2023 Muslim Brand. All rights reserved.
      <button class="underline hover:text-primary" type="button">Privacy Policy</button>
    </p>
  </div>
</div>
